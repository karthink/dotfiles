#!/bin/bash
# AUTHOR: Karthik Chikmagalur

# PARAMETERS - REPLACE AS REQUIRED
#--------------------------------
# TODO: Hit Alt-r to rebuild cache
# TODO: Hit Alt-l to switch to locate

function MENU_OPEN {
    CACHE_CMD=$1
    FF_PIPE=$2
    $TERMINAL -t dropdown_zff -e sh -c "$CACHE_CMD | fzf --bind 'alt-r:execute-silent($CACHE_CMD -r)+abort' --prompt \"Open: \" | cat >$FF_PIPE"
    # $TERMINAL -T dropdown_fzf -e sh -c "PROCESS_FILES >$FF_PIPE"
}

# FZF_DEFAULT_OPTS="--layout=reverse -1 --no-mouse --multi --inline-info --print-query"
FZF_DEFAULT_OPTS="--layout=reverse -1 --no-mouse --multi --inline-info"

CACHE_CMD=ff-cache
ACT_CMD=ff-open

GREP_CMD='ag -i --silent --literal --nonumbers'  #Command to search through the cache
LOCATE_CMD='locate --regex -i --all '            #Locate command
#--------------------------------

cache="/tmp/dmenufindfile.cache"
FF_PIPE=".ffpipe"
cd $HOME

if [[ ! -p $FF_PIPE ]]; then
    echo "creating pipe"
    mkfifo $FF_PIPE
fi


$ACT_CMD &
MENU_OPEN "$CACHE_CMD" "$FF_PIPE"
# PROCESS_FILES
